<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- [ANCHOR:VIEWPORT] -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lottie-превью 360×800</title>

  <!-- [ANCHOR:SCRIPTS_INCLUDE] Lottie Web -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" defer></script>

  <style>
    /* [ANCHOR:CSS_VARS] */
    :root { --h: 800px; --ctl-h: 30px; --safe-bottom: 8px; --vh: 1vh; }

    /* [ANCHOR:CSS_BASE] */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; background: #0f0f10; color: #e8e8e8; font-family: -apple-system, Segoe UI, Roboto, Inter, Arial; }

    /* [ANCHOR:APP_WRAP] */
    .app { max-width: 1000px; margin: 0 auto; padding: 16px; display: flex; flex-direction: column; align-items: center; gap: 12px; }

    /* [ANCHOR:LAYOUT_WRAPPER] */
    .wrapper { width: 360px; height: var(--h); position: relative; overflow: hidden; background:#000; border:none; }
    .stage   { width:100%; height:100%; position:relative; background:#000; }

    /* [ANCHOR:LAYERS] */
    .bg, .lottie-layer { position:absolute; inset:0; }
    .bg {
      background-size: auto 100%;       /* десктоп: фон по высоте */
      background-position: center;
      background-repeat:no-repeat;
      background-color:#000;
    }
    .lottie-layer { display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .lottie-container { width:100%; height:100%; display:flex; align-items:center; justify-content:center; }
    .lottie-layer svg, .lottie-layer canvas {
      height:100% !important; width:auto !important; max-width:none !important;
      display:block !important; position:static !important; margin:0 auto !important;
      left:auto !important; right:auto !important;
    }

    /* [ANCHOR:MODE_PANEL] — панель кнопок (только десктоп) */
    .mode { display:flex; flex-wrap:wrap; gap:8px; font-size:12px; align-items:center; justify-content:center; }
    .mode input[type="file"] { display:none; }
    .btn, .chk { height:var(--ctl-h); padding:0 10px; display:inline-flex; align-items:center; gap:6px; background:#2a2a2a; color:#e8e8e8; border:none; border-radius:6px; font-size:12px; line-height:1; cursor:pointer; user-select:none; }
    .btn:active { opacity:.85; }
    .chk input[type="checkbox"] { width:14px; height:14px; margin:0; }

    /* [ANCHOR:MOBILE_MODE] — телефон: без панели, превью на весь экран по ширине */
    body.is-mobile .mode { display: none !important; }
    body.is-mobile .app { max-width: none; padding: 0; }
    body.is-mobile { overflow: hidden; }
    body.is-mobile .wrapper { position: fixed; inset: 0; width: 100vw; height: 100dvh; background:#000; }
    /* Мобайл: фон по ширине; Lottie подгоняем по полной высоте фоновой картинки (JS) */
    body.is-mobile .bg { background-size: 100% auto; } /* фон по ширине */

    /* [ANCHOR:TOAST_CSS] — тост рядом с кнопкой */
    .toast {
      position: fixed;
      padding: 8px 10px; background: rgba(0,0,0,.85); color: #fff; border-radius: 8px;
      font-size: 12px; opacity: 0; pointer-events: none; transition: opacity .15s ease-out;
      z-index: 1000; backdrop-filter: blur(4px);
      transform: translate(-50%, -6px); /* рендерится над центром кнопки */
    }
    .toast.show { opacity: 1; }

    /* [ANCHOR:VERSION_BADGE_CSS] — бейдж версии */
    .ver {
      position: fixed; right: 8px; bottom: 6px; z-index: 1000;
      font-size: 11px; line-height: 1; padding: 4px 6px; color:#bbb;
      background: rgba(0,0,0,.4); border-radius: 6px; pointer-events:none;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="app"><!-- [ANCHOR:APP_ROOT] -->
    <div id="wrapper" class="wrapper" aria-label="Превью Lottie" role="application"><!-- [ANCHOR:PREVIEW_WRAPPER] -->
      <div id="stage" class="stage"><!-- [ANCHOR:PREVIEW_STAGE] -->
        <div id="bg" class="bg"></div><!-- [ANCHOR:BG_LAYER] -->
        <div class="lottie-layer"><div id="lottie" class="lottie-container"></div></div><!-- [ANCHOR:LOTTIE_LAYER] -->
      </div>
    </div>

    <!-- [ANCHOR:CONTROL_PANEL] — только на десктопе -->
    <div class="mode" id="mode">
      <label class="btn" for="bgInput">Фон</label>
      <input id="bgInput" type="file" accept="image/*">
      <label class="btn" for="lotInput">Lottie</label>
      <input id="lotInput" type="file" accept="application/json,.json">

      <button class="btn" id="sizeBtn">Ширина: 360px</button>
      <button class="btn" id="heightBtn">Высота: 800</button>

      <button class="btn" id="restartBtn" title="Повторить анимацию">Повтор</button>
      <label class="chk" title="Играть зацикленно"><input type="checkbox" id="loopChk"> Зацикленно</label>

      <button class="btn" id="shareBtn" title="Сохранить и получить короткую ссылку">Поделиться</button>
    </div>
  </div>

  <!-- [ANCHOR:TOAST_NODE] -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- [ANCHOR:VERSION_BADGE_NODE] -->
  <div id="ver" class="ver"></div>

  <!-- [ANCHOR:APP_SCRIPT] анти-кэш -->
  <script src="app.js?v=31"></script>
</body>
</html>
